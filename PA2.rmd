# Health & Economic Impact of Storm Events from early 1950 through November 2011

##Synopsis

In this reprot we aim to describe the health impact of storm events between 1950 and Novermber 2011.  Our overall hypothesis is that tornadic events have the highest impact to human health, as measured by injuries and fatalities.  

##Load required libraries for data processing and visualization
```{r}
library("ggplot2")
library("reshape2")
library("knitr")
library("grid")
library("gridExtra")
```

#Data Processing

The data for this assignment come in the form of a comma-separated-value file 
compressed via the bzip2 algorithm to reduce its size.  
It is sourced from the Coursera site.


```{r, cache=TRUE}
#Download file and decompress
url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
file <- basename(url)
download.file(url, file, method="curl")
fcon <- bzfile(file, open="r")
#Read CSV file
stormData <-read.csv(fcon, stringsAsFactors=FALSE)
close(fcon)
```

## Categorize and process the data
```{r}
#Keep relevant columns
stormData <- stormData[, c("BGN_DATE", "STATE", "EVTYPE", "END_DATE", 
        "FATALITIES", "INJURIES", "PROPDMG", "PROPDMGEXP", "CROPDMG", 
        "CROPDMGEXP")]
#Remove non US-states such as PR and ST in the data
stormData <- stormData[(stormData$STATE %in% c(state.abb, "DC")), ]
#Convert END_DATE and BGN_DATE to dates
stormData$BGN_DATE <- as.Date(stormData$BGN_DATE, format="%m/%d/%Y")
stormData$END_DATE <- as.Date(stormData$END_DATE, format="%m/%d/%Y")
#Convert PROPDMGEXP and CROPDMGEXP to factors
stormData$PROPDMGEXP <- as.factor(stormData$PROPDMGEXP)
stormData$CROPDMGEXP <- as.factor(stormData$CROPDMGEXP)
#Lowercase EVTYPE
stormData$EVTYPE <- tolower(stormData$EVTYPE)
#Remove non-pertinent Weather events (no human, property, or crop damage)
stormData <- stormData[!(stormData$FATALITIES == 0 & stormData$INJURIES == 0 & 
        stormData$PROPDMG == 0 & stormData$CROPDMG == 0),]

#Categorize the events from least specific to most
stormData[grepl("turbulence|apache|urban|normal|hyperthermia|record temperatures|
        other|dam|southeast|beach|drowning|none|severe|\\?|mild|excessive|record", 
        stormData$EVTYPE), "Category"] <- "Other Events"
stormData[grepl("dry|drought", stormData$EVTYPE), "Category"] <- "Very Dry/Drought"
stormData[grepl("marine|rough|southeast|seiche|stream|heavy seas|wave", 
        stormData$EVTYPE), "Category"] <- "Sea/Lake/River Events"
stormData[grepl("summary|metro", stormData$EVTYPE), "Category"] <- 
        "Summary of Date"
stormData[grepl("warm|heat|hot|high|warmth", stormData$EVTYPE), "Category"] <- 
        "Heat Events"
stormData[grepl("heavy mix|snow|sleet|wintry|winter|cold|cool|freezing|blizzard|
        freeze|low", stormData$EVTYPE), "Category"] <- 
        "Cold/Snow/Winter Weather/Blizzard"
stormData[grepl("rainfall|rain|precip|precipatation|precipitation|wet",
        stormData$EVTYPE), "Category"] <- "Rain & Percipatation"
stormData[grepl("fog", stormData$EVTYPE), "Category"] <- "Fog"
stormData[grepl("cloud", stormData$EVTYPE), "Category"] <- "Cloud Related Events"
stormData[grepl("dust", stormData$EVTYPE), "Category"] <- "Dust Related Events"
stormData[grepl("floodin|stream fld|flood|rapidly|flash", stormData$EVTYPE), 
        "Category"] <- "Flood"
stormData[grepl("torndao|tornado|funnel|spout|gustnado", stormData$EVTYPE), 
        "Category"] <- "Tornado/Gustnado/Funnel Cloud/Waterspout"
stormData[grepl("avalance|avalanche", stormData$EVTYPE), "Category"] <- "Avalanche"
stormData[grepl("coastalstorm|coastal storm", stormData$EVTYPE), "Category"] <- 
        "Coastal Storm"
stormData[grepl("thunderstorm|tstm|thunderstormw|lightning|lighting|ligntning", 
        stormData$EVTYPE), "Category"] <- "Thunderstorms/Lightning"
stormData[grepl("glaze|frost|ice|icy", stormData$EVTYPE), "Category"] <- 
        "Ice Events"
stormData[grepl("wind|burst", stormData$EVTYPE), "Category"] <- 
        "Wind, Microbursts, and Downburst Events"
stormData[grepl("hail", stormData$EVTYPE), "Category"] <- "Hail Events"
stormData[grepl("hurricane", stormData$EVTYPE), "Category"] <- "Hurricanes"
stormData[grepl("current|tide|surf|surge", stormData$EVTYPE), "Category"] <- 
        "Currents, Surfs, and Tides"
stormData[grepl("fires|wildfire|fire|smoke", stormData$EVTYPE), "Category"] <- 
        "Fires/Smoke"
stormData[grepl("mud|rock|mudslides|landslide|landslump|erosion", stormData$EVTYPE), 
          "Category"] <- "Rock/Mud/Landslides & Erosion"
stormData[grepl("tropical storm|depression", stormData$EVTYPE), "Category"] <- 
        "Tropical Storms/Depressions"
stormData[grepl("tsunami", stormData$EVTYPE), "Category"] <- "Tsunami"
```


#Results

##Across the United States, which types of events are most harmful with respect to population health?

Given the two graphs below, torandic events are clearly most harmful to population 
health.

```{r, fig.height=20}

#Plot All Events by Category
stormHealth <- aggregate(cbind(FATALITIES, INJURIES) ~ Category, sum, data = 
        stormData)
stormHealth <- stormHealth[!(stormHealth$FATALITIES == 0 & 
        stormHealth$INJURIES == 0),]
#Melt data by category to allow for an easy barplot
meltStormHealth <- melt(stormHealth, id="Category", variable.name="Health_Type", 
        value.name="Number_Of_Incidents")
p1 <- qplot(x=Category, y=Number_Of_Incidents, fill=Health_Type, 
        data=meltStormHealth, geom="bar", stat="identity") + coord_flip()

#Break down the "Largest Category"
stormLargeHealth <- stormData[(stormData$Category == 
        "Tornado/Gustnado/Funnel Cloud/Waterspout"),]
stormLargeHealth <- aggregate(cbind(FATALITIES, INJURIES) ~ EVTYPE, sum, 
        data = stormLargeHealth)
stormLargeHealth <- stormLargeHealth[!(stormLargeHealth$FATALITIES == 0 & 
        stormLargeHealth$INJURIES == 0),]
#Melt data by category to allow for an easy barplot
meltStormLargeHealth <- melt(stormLargeHealth, id="EVTYPE", 
        variable.name="Health_Type", value.name="Number_Of_Incidents")
p2 <- qplot(x=EVTYPE, y=Number_Of_Incidents, fill=Health_Type, 
        data=meltStormLargeHealth, geom="bar", stat="identity") + 
        coord_flip() + xlab("Event Type")

grid.arrange(p1, p2, ncol = 1, main = "Health Events (Top= All Event Types, 
        Bottom=Fine Grain Detail of Tornado/Gustnado/Funnel Cloud/Waterspoint category)")
```

As shown in the table below, see the highest number of incidents by type, 
it continues to show Tornado as the deadliest

```{r, results='asis'}
#Create two data frames, fatalities and injuries sorted by the highest counts at the top
meltFatalities <- meltStormHealth[meltStormHealth$Health_Type == "FATALITIES",]
meltFatalities <- meltFatalities[order(meltFatalities$Number_Of_Incidents, decreasing=TRUE),]

#Start new data frame with just number of incidnets and make categories the rowname
fatalities <- data.frame(meltFatalities$Number_Of_Incidents)
rownames(fatalities) <- meltFatalities$Category
colnames(fatalities) <- "Number of Fatalities"

#Start creating melted Injuries focued data frame
meltInjuries <- meltStormHealth[meltStormHealth$Health_Type == "INJURIES",]
meltInjuries <- meltInjuries[order(meltInjuries$Number_Of_Incidents, decreasing=TRUE),]

#Start new data frame with just number of incidnets and make categories the rowname
injuries <- data.frame(meltInjuries$Number_Of_Incidents)
rownames(fatalities) <- meltInjuries$Category
colnames(injuries) <- "Number of Injuries"

#output the tables in html
t1 = kable(fatalities, format='html', output = FALSE)
t2 = kable(injuries, format='html', output = FALSE)
cat(c('<table><tr valign="top"><td>', t1, '</td><td>', t2, '</td><tr></table>'), sep = '')
```

##Across the United States, which types of events have the greatest economic consequences?

```{r, fig.height=20}

#Plot All Events by Category
stormPropEcom <- stormData[!(stormData$PROPDMG == 0),]
stormCropEcom <- stormData[!(stormData$CROPDMG == 0),]
stormEcom <- aggregate(cbind(PROPDMG, PROPDMGEXP, CROPDMG) ~ Category, sum, data = 
        stormData)
stormHealth <- stormHealth[!(stormHealth$FATALITIES == 0 & 
        stormHealth$INJURIES == 0),]
#Melt data by category to allow for an easy barplot
meltStormHealth <- melt(stormHealth, id="Category", variable.name="Health_Type", 
        value.name="Number_Of_Incidents")
p1 <- qplot(x=Category, y=Number_Of_Incidents, fill=Health_Type, 
        data=meltStormHealth, geom="bar", stat="identity") + coord_flip()

#Break down the "Largest Category"
stormLargeHealth <- stormData[(stormData$Category == 
        "Tornado/Gustnado/Funnel Cloud/Waterspout"),]
stormLargeHealth <- aggregate(cbind(FATALITIES, INJURIES) ~ EVTYPE, sum, 
        data = stormLargeHealth)
stormLargeHealth <- stormLargeHealth[!(stormLargeHealth$FATALITIES == 0 & 
        stormLargeHealth$INJURIES == 0),]
#Melt data by category to allow for an easy barplot
meltStormLargeHealth <- melt(stormLargeHealth, id="EVTYPE", 
        variable.name="Health_Type", value.name="Number_Of_Incidents")
p2 <- qplot(x=EVTYPE, y=Number_Of_Incidents, fill=Health_Type, 
        data=meltStormLargeHealth, geom="bar", stat="identity") + 
        coord_flip() + xlab("Event Type")

grid.arrange(p1, p2, ncol = 1, main = "Health Events (Top= All Event Types, 
        Bottom=Fine Grain Detail of Tornado/Gustnado/Funnel Cloud/Waterspoint category)")
```
